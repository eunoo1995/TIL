# 📖 오늘의 학습

## 브라우저의 렌더링 과정

> 대부분의 언어는 OS나 VM에서 실행되지만, 자바스크립트는 브라우저에서 HTML, CSS와 함께 실행되는 경우가 많다. 이 때 브라우저는 렌더링을 위해 텍스트 문서를 파싱한다.

### 요청과 응답

브라우저는 필요한 리소스를 서버에 요청하고 응답받아 브라우저에 시각적으로 렌더링한다. 리소스는 모드 서버에 존재하므로 서버에서 받은 리소스를 파싱하여 렌더링하는 것이다. 서버에 요청을 보내기 위해 브라우저는 주소창을 제공한다. URL로 요청을 보낼 경우 DNS를 통해 IP주소로 변환하여 그 주소를 갖는 서버에 요청을 전송한다.

### HTTP1.1과 HTTP2.0

> HTTP는 브라우저와 서버가 통신하기 위한 프로토콜(규약)이다.

- HTTP1.1은 한번의 커넥션당 하나의 요청과 응답만 처리한다. 여러 개의 요청을 한 번에 전송할 수 없고 응답도 한번에 받을 수 없다. 따라서 리소스의 개수에 의해 응답 시간도 증가하는 단점이 있다.
- HTTP2.0은 한 커넥션으로 여러개의 요청과 응답이 가능하고 리소스의 우선 순위를 지정할 수 있다.

### HTML 파싱과 DOM 생성

서버에 존재하는 HTML 문서는 순수한 텍스트이다. 브라우저에 시각적인 픽셀로 그려내려면 이해할 수 있는 자료구조(객체)로 변환하여 저장해야 한다. 서버에 요청한 HTML은 바이트코드로 변환되어 응답을 받는다. 이 바이트코드를 HTML 메타태그의 charset 어트리뷰트 인코딩 방식에 의해 문자열로 변환한다. 변환한 문자열을 최소의 문법적인 의미를 갖는 단위인 토큰으로 분해하고 토큰을 객체로 변환하여 노드를 생성한다. 생성된 노드들은 중첩 관계에 의해 트리 자료구조로 구성되고 이렇게 완성된 객체를 DOM이라고 한다.

### CSS 파싱과 CSSOM 생성

브라우저의 렌더링 엔진이 HTML을 파싱하며 DOM을 생성하다가 link, style 태그를 만나면 DOM 생성을 일시 중단하고 CSS를 파싱한다. DOM과 동일한 해석을 거쳐 CSSOM을 생성하고 중단된 시점의 HTML 파싱을 시작하여 DOM 생성을 재개한다.

### 렌더 트리 생성

파싱하여 완성된 DOM과 CSSOM을 결합하여 렌더 트리로 만든다. 렌더 트리는 화면에 렌더링되지 않는 노드들은 포함하지 않는다. 이렇게 완성된 렌더 트리는 요소의 레이아웃을 계산하는데 사용되며 브라우저 화면에 픽셀을 렌더링 하는 페인팅 처리에 입력된다. 레이아웃에 영향을 주는 일이 발생하면 리플로우와 리페인트가 발생하는 리렌더링이 발생한다. 리렌더링은 성능에 악영향을 주므로 빈번하게 발생하지 않도록 주의할 필요가 있다.

### 자바스크립트 파싱과 실행

렌더링 엔진이 파싱하여 DOM을 생성하는 도중 script 태그를 만나면 DOM 생성을 일시 중단하고 javascript 엔진에게 제어권을 넘겨 파싱과 실행 후 다시 렌더링 엔진에게 제어권을 넘긴다. 자바스크립트의 파싱과 실행은 렌더링 엔진이 아닌 자바스크립트 엔진이 처리한다. 동일한 파싱 과정을 거쳐 토큰을 가지고 AST를 생성하고 이를 기반으로 인터프리터가 실행할 수 있는 중간 코드를 생성하여 실행한다.

### 리플로우와 리페인트

자바스크립트에서 DOM이나 CSSOM을 변경하는 DOM API가 사용된 경우 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 이를 기반으로 레이아웃과 페인트 과정을 거쳐 화면에 다시 렌더링한다. 이를 리플로우, 리페인트라고 한다. 레이아웃에 변경이 없으면 리페인트만 실행된다.

### 자바스크립트 파싱에 의한 HTML 파싱 중단

렌더링 엔진과 자바스크립트 엔진은 병렬적으로 동작하지 않고 직렬적으로 파싱을 수행한다. 이처럼 브라우저는 동기적으로 위에서 아래 방향으로 순차적으로 파싱하고 실행한다. 따라서 script 태그의 위치는 중요한 의미를 가진다. 자바스크립트 내에서 아직 생성되지 않은 DOM 요소를 사용할 경우 오류가 발생한다. 이러한 문제를 해결하기 위해 body 클로징 태그 직전에 자바스크립트 코드를 위치시킨다. 오류를 방지할 수 있으며 자바스크립트가 실행되기 전에 렌더링이 완료되므로 페이지 로딩 시간이 단축되는 이점도 있다.

### script 태그의 async / defer 어트리뷰트

자바스크립트 파싱에 의한 블로킹 문제를 근본적으로 해결하기 위해 HTML5부터 두 어트리뷰트가 추가되었다. 인라인 스크립트의 경우 사용할 수 없다. 두 속성을 사용하면 외부 파일의 로드와 HTML 파싱이 동시에 비동기적으로 진행된다. async는 로드가 비동기적으로 처리된 후 바로 스크립트를 실행하며 HTML 파싱이 중단된다. 또 여러개의 async는 순서를 보장하지 않는다. defer는 로드가 비동기적으로 진행된 후 DOM 생성이 완료된 직후에 실행한다. 따라서 DOM 생성이 완료된 이후 실행되어야 할 자바스크립트에 유용, 순서를 보장한다.

# 💥 수업 정리

- 오늘부턴 에크마스크립트가 아닌 WEB API에 대한 얘기이다!!!!!!
- 도메인과 IP주소는 식별자와 값 같은 것이다.
- 토큰이라는 것은 자바스크립트에 종속된 것이 아닌 문법적인 의미의 최소 단위를 말한다.
- DOM은 큰 의미에선 API까지 포함된다. 돔 트리와 돔 API 포함 일반적으로는 돔 트리를 지칭
- 모듈은 기본적으로 defer로 동작, ES모듈을 사용하는 경우가 드물다.
- async는 잘 안쓴다. font 로드할 때 사용하는 경우는 있음, 미리 가져와야 할 경우
- 모던 자바스크립트는 defer를 사용하여 스크립트를 헤더에 작성할 수 있게 된다.
- Load 이벤트는 모든 리소스가 완료되었을 때, DOMContentLoaded는 돔만!!!!!!
- DOMContentLoaded는 첫 화면이 준비됬을 떄 하고싶은 이벤트가 있을 떄
- Load 이벤트는 이미지에 주로 사용 이미지 지연 로딩(lazy loading)
- HTTP는 책을 사서 볼 것!!!!!!!! form 요소 내부의 값들이 전송되는 방식을 공부해보자
- 전압을 2진수화 하고 charset 에 지정한 인코딩 (utf-8) 문자열로 변환, HTTP는 아스키코드이다.
- 자바스크립트는 유니코드로 변환한다!
- 리플로우를 중요하게 생각해야 한다. 성능 저하의 주 원인
- 생각보다 예상하지 못한 리플로우 발생 요인들이 많다. API를 사용할 때 리플로우 여부 확인해보는 것이 좋다.
- 첫 페이지의 로딩 속도는 중요하게 신경써야 한다. 2초 이내여야 배포 가능하다.
- 일단 성능 없이 코딩, 완료 후 측정했을 때 초과되었다면 성능 관련 리팩토링
- 성능 부분은 이미지가 큰 비중을 차지하므로 코딩과 조금은 거리가 있다.
- innerHTML의 가장 큰 문제는 무언가를 추가할 때 전체를 다시 그리는 것, 리플로우 빈번
- 라이브러리나 프레임워크는 효율적인 돔 렌더링에 대한 기능들을 제공한다.
- 바닐라 js로 돔을 조작할 때의 문제점을 알아야 프레임워크를 사용하는 의미가 있다.
- 엔진마다 리플로우를 발생시키는 것이 상이할 수 있다.
- 사용할 것과 안할 것을 구분해서 공부해야 한다. id는 getElementById 나머지는 쿼리셀렉터
- 쿼리셀렉터는 css 선택자를 파싱해야 하므로 조금 더 느리다.
- id는 충분히 중복될 가능성이 있다.
- getElemets 계열은 사용 금지, querySelectorAll로 가져오고 배열로 변환하여 사용할 것
- 공백 텍스트 노드를 피하기 위해 Element가 제공하는 메서드들을 사용할 것
- 크롬에서 제공하는 개발자 도구의 == $0 는 해당 요소를 반환해준다.
- 프로퍼티는 최신 상태값, 어트리뷰트는 초기값
- 이벤트와 DOM은 같이 알아야 한다.
- 브라우저가 이벤트를 캐치해내고 우리는 브라우저에게 명령을 내려야 한다. 이벤트 등로
- innerHTML을 사용 시 신뢰할 수 없는 데이터는 살균 처리(라이브러리)를 한 후 사용할 것

# 🤯 하루을 마치며…

벌써 책의 3/4가 지나가고 있다. 앞의 내용들이 점점 가물가물해질 시점인 듯 하다. 지금 읽고있는 내용들의 난이도가 너무 높아서 앞을 다시 볼 수 있는 시간이 되지 않지만 9/2 이후 책을 다 보고나서 공부한 내용들이 잊혀지기 전에 복습하는 시간을 가져야할 것 같다. 알고리즘 공부도 지금 진행하지 못하고 있어서 불안하지만 아직 4달의 시간이 남아있으니 마음을 다잡고 차근차근 공부해나가는 것이 중요한 것 같다. 남은 수업도 이해할 수 있도록 예습을 철저히 해야겠다.

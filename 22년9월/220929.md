# 📖 딥다이브 복습

## 브라우저의 렌더링 과정

> 대부분의 언어는 OS나 VM에서 실행되지만, 자바스크립트는 브라우저에서 HTML, CSS와 함께 실행되는 경우가 많다. 이 때 브라우저는 렌더링을 위해 텍스트 문서를 파싱한다.

### 요청과 응답

브라우저는 필요한 리소스를 서버에 요청하고 응답받아 브라우저에 시각적으로 렌더링한다. 리소스는 모드 서버에 존재하므로 서버에서 받은 리소스를 파싱하여 렌더링하는 것이다. 서버에 요청을 보내기 위해 브라우저는 주소창을 제공한다. URL로 요청을 보낼 경우 DNS를 통해 IP주소로 변환하여 그 주소를 갖는 서버에 요청을 전송한다.

### HTTP1.1과 HTTP2.0

> HTTP는 브라우저와 서버가 통신하기 위한 프로토콜(규약)이다.

- HTTP1.1은 한번의 커넥션당 하나의 요청과 응답만 처리한다. 여러 개의 요청을 한 번에 전송할 수 없고 응답도 한번에 받을 수 없다. 따라서 리소스의 개수에 의해 응답 시간도 증가하는 단점이 있다.
- HTTP2.0은 한 커넥션으로 여러개의 요청과 응답이 가능하고 리소스의 우선 순위를 지정할 수 있다.

### HTML 파싱과 DOM 생성

서버에 존재하는 HTML 문서는 순수한 텍스트이다. 브라우저에 시각적인 픽셀로 그려내려면 이해할 수 있는 자료구조(객체)로 변환하여 저장해야 한다. 서버에 요청한 HTML은 바이트코드로 변환되어 응답을 받는다. 이 바이트코드를 HTML 메타태그의 charset 어트리뷰트 인코딩 방식에 의해 문자열로 변환한다. 변환한 문자열을 최소의 문법적인 의미를 갖는 단위인 토큰으로 분해하고 토큰을 객체로 변환하여 노드를 생성한다. 생성된 노드들은 중첩 관계에 의해 트리 자료구조로 구성되고 이렇게 완성된 객체를 DOM이라고 한다.

### CSS 파싱과 CSSOM 생성

브라우저의 렌더링 엔진이 HTML을 파싱하며 DOM을 생성하다가 link, style 태그를 만나면 DOM 생성을 일시 중단하고 CSS를 파싱한다. DOM과 동일한 해석을 거쳐 CSSOM을 생성하고 중단된 시점의 HTML 파싱을 시작하여 DOM 생성을 재개한다.

### 렌더 트리 생성

파싱하여 완성된 DOM과 CSSOM을 결합하여 렌더 트리로 만든다. 렌더 트리는 화면에 렌더링되지 않는 노드들은 포함하지 않는다. 이렇게 완성된 렌더 트리는 요소의 레이아웃을 계산하는데 사용되며 브라우저 화면에 픽셀을 렌더링 하는 페인팅 처리에 입력된다. 레이아웃에 영향을 주는 일이 발생하면 리플로우와 리페인트가 발생하는 리렌더링이 발생한다. 리렌더링은 성능에 악영향을 주므로 빈번하게 발생하지 않도록 주의할 필요가 있다.

### 자바스크립트 파싱과 실행

렌더링 엔진이 파싱하여 DOM을 생성하는 도중 script 태그를 만나면 DOM 생성을 일시 중단하고 javascript 엔진에게 제어권을 넘겨 파싱과 실행 후 다시 렌더링 엔진에게 제어권을 넘긴다. 자바스크립트의 파싱과 실행은 렌더링 엔진이 아닌 자바스크립트 엔진이 처리한다. 동일한 파싱 과정을 거쳐 토큰을 가지고 AST를 생성하고 이를 기반으로 인터프리터가 실행할 수 있는 중간 코드를 생성하여 실행한다.

### 리플로우와 리페인트

자바스크립트에서 DOM이나 CSSOM을 변경하는 DOM API가 사용된 경우 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 이를 기반으로 레이아웃과 페인트 과정을 거쳐 화면에 다시 렌더링한다. 이를 리플로우, 리페인트라고 한다. 레이아웃에 변경이 없으면 리페인트만 실행된다.

### 자바스크립트 파싱에 의한 HTML 파싱 중단

렌더링 엔진과 자바스크립트 엔진은 병렬적으로 동작하지 않고 직렬적으로 파싱을 수행한다. 이처럼 브라우저는 동기적으로 위에서 아래 방향으로 순차적으로 파싱하고 실행한다. 따라서 script 태그의 위치는 중요한 의미를 가진다. 자바스크립트 내에서 아직 생성되지 않은 DOM 요소를 사용할 경우 오류가 발생한다. 이러한 문제를 해결하기 위해 body 클로징 태그 직전에 자바스크립트 코드를 위치시킨다. 오류를 방지할 수 있으며 자바스크립트가 실행되기 전에 렌더링이 완료되므로 페이지 로딩 시간이 단축되는 이점도 있다.

### script 태그의 async / defer 어트리뷰트

자바스크립트 파싱에 의한 블로킹 문제를 근본적으로 해결하기 위해 HTML5부터 두 어트리뷰트가 추가되었다. 인라인 스크립트의 경우 사용할 수 없다. 두 속성을 사용하면 외부 파일의 로드와 HTML 파싱이 동시에 비동기적으로 진행된다. async는 로드가 비동기적으로 처리된 후 바로 스크립트를 실행하며 HTML 파싱이 중단된다. 또 여러개의 async는 순서를 보장하지 않는다. defer는 로드가 비동기적으로 진행된 후 DOM 생성이 완료된 직후에 실행한다. 따라서 DOM 생성이 완료된 이후 실행되어야 할 자바스크립트에 유용, 순서를 보장한다.

# 🤯 하루를 마치며…

- 아침 러버덕 진행 방법에 대하여 바꿔보는 것으로 정했다. 복습 러버덕을 진행하며 전체를 다시 한 번 복습하는 것을 완료해서 이제 서로가 책의 내용 중 중요하거나 면접 시 질문으로 받을 것 같은 부분을 정리하여 실제 면접을 진행하는 것처럼 서로에게 질문하고 꼬리 질문을 이어나가는 방법으로 진행해보기로 했다. 기술 면접을 대비하여 개념들을 반복적으로 읽어 까먹지 않도록 해야겠다!
- 오늘은 8번 구현을 마치고 다시 1번부터 리팩토링을 진행하였다. 중복을 최대한 제거하고 변수 이름을 수정하였으며 복잡성을 해결하고 최대한 가독성이 좋게 구현하기 위해 노력했다. 오늘은 8번 뉴스 뷰어 미션이 생각보다 고쳐야 할 부분들이 많다는 것을 발견하였고, 9번 10번을 진행하기 전에 최대한 앞의 미션들을 완성도 있게 마무리하여 난이도가 높은 9~10번을 집중해서 구현해야겠다!
